{"componentChunkName":"component---src-templates-blog-post-js","path":"/development/library_deploy/","result":{"data":{"site":{"siteMetadata":{"title":"Maeng's Blog","author":"Maeng","siteUrl":"https://maeng2418.github.io","comment":{"disqusShortName":"","utterances":"maeng2418/maeng2418.github.io"}}},"markdownRemark":{"id":"3bbe8452-129c-5997-91cf-dcd6076a6165","excerpt":"개요 언젠가 한번 나만의 라이브러리를 만들어서 배포해보고 싶다는 생각을 갖구있다가 이번에 디자인시스템 개발을 도전하게 되었다. 리액트 컴포넌트 기반으로 디자인시스템 개발에 대한 자료를 찾아보다가  +  +  을 활용하여 개발을 진행하고 웹팩대신  이용해서 빌드하여 npm으로 배포를 한다는 블로그 글들을 많이 찾게 되었고 도전해보기로 했다 Rollup ?  ,  그리고  요것들(?)은 뭐 기존에 프론트 개발을 하면서 많이 사용해봐서 알겠는데 웹팩 말고 Rollup…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p>언젠가 한번 나만의 라이브러리를 만들어서 배포해보고 싶다는 생각을 갖구있다가 이번에 디자인시스템 개발을 도전하게 되었다. 리액트 컴포넌트 기반으로 디자인시스템 개발에 대한 자료를 찾아보다가 <code class=\"language-text\">Typescript</code> + <code class=\"language-text\">Storybook</code> + <code class=\"language-text\">React</code> 을 활용하여 개발을 진행하고 웹팩대신 <code class=\"language-text\">Rollup</code> 이용해서 빌드하여 npm으로 배포를 한다는 블로그 글들을 많이 찾게 되었고 도전해보기로 했다</p>\n<h2 id=\"rollup-\" style=\"position:relative;\"><a href=\"#rollup-\" aria-label=\"rollup  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rollup ?</h2>\n<p><code class=\"language-text\">Typescript</code> , <code class=\"language-text\">Storybook</code> 그리고 <code class=\"language-text\">React</code> 요것들(?)은 뭐 기존에 프론트 개발을 하면서 많이 사용해봐서 알겠는데 웹팩 말고 Rollup? 이건 뭐하는거지?? 내가 아는 번들러라고는 웹팩이 유일무이했는데 Rollup이란게 있다고?</p>\n<p>라이브러리를 배포하려면, 보통 webpack 과 같은 도구로 라이브러리도 번들링을 해주어야 한다. 번들링은 필수는 아니며 TypeScript 또는 Babel로 코드를 트랜스파일해서 등록을 할 수도 있다.</p>\n<p>그럼 번들링 도구로 webpack을 쓸 수도 있는데 Rollup을 쓰는 이유는 뭘까?</p>\n<p>webpack은 ES Module 형태로 번들을 할 수 없다. webpack을 사용 할 때에는 일반적으로 commonjs 형태로 번들링을 하게 되는데, commonjs로 번들링한 라이브러리를 나중에 다른 프로젝트에서 사용하게 되면 Tree-Shaking 을 지원하지 않는다고 한다.</p>\n<p>그럼 또 Tree-Shaking은 뭐지???</p>\n<aside>\n💡 배포한 라이브러리를 설치하고 그 중에서 Button 컴포넌트만 사용한다고 할 때, Tree-shaking이 되었다면 프로젝트를 빌드할 때, Button 컴포넌트 외에 다른 컴포넌트를 사용하지 않았기 때문에 빌드된 파일에도 다른 컴포넌트와 관련된 코드가 포함되지 않게 된다. 즉, 사용한 컴포넌트만 코드에 포함된다고 한다.\n</aside>\n<br/>\n<p>🚀 <strong>참고</strong></p>\n<p><a href=\"https://perfectacle.github.io/2017/03/12/webpack2-tree-shaking/\">(Webpack 2) 트리 쉐이킹을 해보자!</a></p>\n<p>오… 그럼 ES Module 형태로 배포하는게 좋은건가보네?</p>\n<h2 id=\"시작하기\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\" aria-label=\"시작하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시작하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// rollup.config.js</span>\n<span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">file</span><span class=\"token operator\">:</span> <span class=\"token string\">'build/index.js'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">format</span><span class=\"token operator\">:</span> <span class=\"token string\">'es'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">sourcemap</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">exports</span><span class=\"token operator\">:</span> <span class=\"token string\">'named'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>rollup.config.js에 output에 format을 ‘es’로 설정해주면 ES Module 형태로 번들링해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 546px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnElEQVQoz4WSSW4UQRBF6wpcoN1VlZmVWVPWPHT1aOShoZEM10CyhMSeFWw5CId8qNKmEZZtFrGIkPLHi//TMyYmNjFf3p/4dHNF2hX0h5FyqBGhRCqFlH9LCPlP72ahJCkyIqPxtDZESnH/4SPvtreYJqffj6Rljr/wCfyQYBkQLMOz2FPRuTdJjIoiPCEEWmfE5ZJv39esphY71LS7nu4w0u4G+suVo9ax+Q+hmQUlOkooCs3n+2vGqSOrC8q+cmcXXUnZ11Srxj14VnDWMAalIryHDYJAGt5EG4Qt6Y5r2uMWOzU01xNZX+Evg5dPDgRJbTE2xRPzUEhCqVk0B1RmyRpL1pUkVU7aWJLKvh6KkESzh1rjKSlZLCWbXvHrh884JlQ3W7rjhmrfkw81wUVwTvtZwUCQNsUD4TwIQolNFXdXijjRpG3pCOeKi4zQD129lnIUmz+EiotHwp9fJXmV0p32DKcd1WFwlO3tmvHuEpOnzu+nhOFM2BZuuXfeECneTpIs15jSktbWnTH7OJ8yB6OMftlDo90//A12bS/W7ahocAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/3e6e3ee660709ea2981ed73429028d04/76aed/1.png\"\n        srcset=\"/static/3e6e3ee660709ea2981ed73429028d04/5a46d/1.png 300w,\n/static/3e6e3ee660709ea2981ed73429028d04/76aed/1.png 546w\"\n        sizes=\"(max-width: 546px) 100vw, 546px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1032px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABS0lEQVQoz42RS27bQBQEdY2Q8/88cigOKYkUwUiQEdtC7n+jCuxsslMWhUZvCmj0YepGZql0ZWLcboj0VDnSxcDl2CExYqxHa40x5iUHEwQRYRwEyQHrPDYKLhess8ToiL5Bte3/CfPQUy8zp21hvq5M68bl55W6nDhfK/tjYV4rPglN29IohdIarRRaK9RXV+03XysOl+q4L5VtvnFddpaPd5Z9476deH6+8f7rwfP3k7d9Zzv27NORPid8Xwm5p0xnhvPKeFqJIXJY5khJkTEJXfDkLiE5MvaZqWTGPjGVRImBURJVEil4bEi4EAgpE3JHyh3OOg7OWrSyaKOw1mCNxRhF07T8+IemVX95Nfk8zmznK1NN7PeZ22Nh3Qr9MeGTI4rHBUfMHuctRr84RUrGZ0fsAqlE8hC/U8ZE6iO5RKIEZEiE5F8K/wAhZuRqeG5sDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/5350c30ef002685761b77f759882570b/12bff/2.png\"\n        srcset=\"/static/5350c30ef002685761b77f759882570b/5a46d/2.png 300w,\n/static/5350c30ef002685761b77f759882570b/0a47e/2.png 600w,\n/static/5350c30ef002685761b77f759882570b/12bff/2.png 1032w\"\n        sizes=\"(max-width: 1032px) 100vw, 1032px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br/>\n빌드를 해주면 <code class=\"language-text\">export</code>를 사용해서 위와 같이 내가 만든 Button 컴포넌트를 내보낸다.</p>\n<p>이제 <code class=\"language-text\">npm publish</code> 이용해서 배포를 해보고 CRA(create-react-app) CNA(create-next-app)을 이용해서 프로젝트를 생성하고 내가 만들어서 배포한 라이브러리를 설치해서 Button 컴포넌트를 제대로 불러오는지 실험해보았다. <code class=\"language-text\">Unexpected token 'export'...</code> 에러가 발생했다…😇</p>\n<p>뭔데… 왜 안되는데 문제 있는거 아니야?? 뭐 설정을 잘못했나? 뭐가 문제인데?? 흠…</p>\n<p>흠… 뭐지? 내가 설정을 잘못했나?싶어 여러 다른 라이브러리를 찾아보던 중 <code class=\"language-text\">[class101 ui](https://ui.class101.dev/)</code> 라는 <strong>클래스101</strong> 에서 사용하는지는 잘 모르겠지만 클래스101에서 개발한 디자인시스템이 rollup으로 빌드를 해서 배포한 것이라 동일하게 CRA와 CNA 프로젝트에 설치하여 컴포넌트를 불러온 결과는 역시 똑같다…</p>\n<p>그럼 다른 라이브러리는 괜찮나? 싶어 <code class=\"language-text\">Antd</code> 와 <code class=\"language-text\">Material-ui</code> 를 설치해서 실험해보도록 했다.</p>\n<p>실험 결과, 모두 정상 동작한다. 역시 유명 라이브러리는 다르네…</p>\n<p>이후 계속 다른 블로그들을 찾아보며 여러 설정을 바꿔보면서 파악한 결과, <code class=\"language-text\">ES Module</code>로 빌드하여 배포한 것은 CNA에서 이상하게도 에러를 뱉어내고 <code class=\"language-text\">CommonJS</code> 형태로 빌드한 것은 잘 동작하는 것을 실험을 통해 알게 됨.</p>\n<p>흠… 그럼 유명 라이브러리랑 내가 배포한 라이브러리랑 차이는 뭔데…?</p>\n<p>차이를 알아보고자 삽질을 해보도록 했다. 해당 라이브러리를 뜯어보고 또 평소에는 그냥 모르고 지나쳤던 node의 package 관리에 대해 정보를 찾아보며 무엇을 잘못했나에 대해 찾아보았다.</p>\n<p>여러 라이브러리 배포에 대해 포스팅한 블로그를 살펴보았고 , 그 중 rollup으로 배포를 시도한 몇몇 포스팅에서 ejs와 cjs 모두 빌드하고 package.json에 main은 cjs의 경로를 module은 ejs의 경로를 지정하는 것을 발견하였다.</p>\n<p>뭐지? 둘중 하나도 아니고 둘다 빌드를 한다고? 흠… 그럼 자동으로 ESModule 프로젝트이면 ejs로 빌드된 코드를 가져오고, CommonJS 프로젝트에서는 cjs 코드를 가져온다는 의미인가? 어떻게 동작하는 거지???</p>\n<p>라는 궁금증이 생겼다. 뭔가 하나를 알려고 팠더니 파도파도 계속 궁금한게 늘어만 간다…☠️</p>\n<p>먼저, package.json의 main이라는 키값에 대한 설명을 찾았다.<br/><br/></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 811px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuklEQVQY061QWQqFMAzs/a9XsUVw3xdErbsf85iAnuAVSjKTzCSt8n0f8zzjX0eN44iqqpDnObIsQ1EUSJIEcRwLn6ap8My7rkPbth9HTV3XgpkPwwBFAwKalGUpAs/zEASBNJNjPQxDGUJMA+IoinCeJ67rwn3feJ4H6p1KMSMFzGnCYe9m5F/zpmlkG+bU9H0vNb5WWWvBf9Rawxgjzfu+Y5ombNuGdV0FMzrnJJLn5d8vy/Lxx3HgBwlzeA8Uw8rxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/06d319d5c083e89d2b95d9ddb2ac1947/fd28b/3.png\"\n        srcset=\"/static/06d319d5c083e89d2b95d9ddb2ac1947/5a46d/3.png 300w,\n/static/06d319d5c083e89d2b95d9ddb2ac1947/0a47e/3.png 600w,\n/static/06d319d5c083e89d2b95d9ddb2ac1947/fd28b/3.png 811w\"\n        sizes=\"(max-width: 811px) 100vw, 811px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br/></p>\n<p>이처럼 package.json에서 main은 디렉토리가 위치한 엔트리 포인트를 나타낸다. 즉, 이 패키지의 메인 파일명에 대한 지정을 나타낸다. 따라서, 빌드한 파일로 떨궈진(?) index.js에 대한 경로를 적어주면, 라이브러리를 import 하거나 require 할 때, 이 main에 적혀진 파일을 참조하여 가져온다.</p>\n<p>음…? 그럼 만약 내 프로젝트가 ES Module 로 작성된 플젝이면…?? package.json의 main에 cjs 경로 적어주고 module에 ejs 경로 적어줬으니깐 알아서 자동으로 module에 적혀있는 ejs를 가져다 쓴다는건가??</p>\n<p>그래서 시작된 노가다…</p>\n<p>먼저, 플젝에 <code class=\"language-text\">const { Button } = require('my-library')</code> 를 삽입하고 어떤 것을 참조하나 보았다.</p>\n<p>당연하게도, package.json의 main에 설정해두었던 경로를 참조한다.</p>\n<p>두 번째, package.json 에 <code class=\"language-text\">\"type\" : \"module\"</code> 로 지정하여 ES Module을 사용하는 플젝을 하나 파서 <code class=\"language-text\">import { Button } from 'my-library'</code> 해보고 어떤 것을 참조하나 보았다.</p>\n<p>뭐지…? package.json의 module이 아니라 main인 cjs 코드 참조하네…;;</p>\n<p>그럼 뭔데 어떻게 동작하는건데~~!!! 그리고 ES Module 플젝인데 cjs코드 가져다가 임포트시켜도 동작하네…?</p>\n<p>계속해서 궁금증이 또 추가 되었다…</p>\n<p>일단 알게된 ES Module과 CommonJS 차이점!<br/><br/></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACMElEQVQ4y4VUiY7aQAzN//8OiFYCSkEggSgsQoQjy01BAXKQg9zJq2wxaZayW0sWYM882+95kFCwLMvYyTzPQ7fbZR8MBuh0OphMJvnZfr+PZrOJRqOBarWK7XbLcQlPJgDJjscj2u02er0exuMx7vd7nguCgIuIQiInvQKLoog7pEOmaeJ2u8FxHPi+D9d1Oe4HPjRd4zzFKEdxKU1TFJ1ACSxJEv79XIzBfP95sPz+PyOT0YXi6EVAz/eQRDGcxIERmQi8gIuI4tJqtcLhcGC+drsdFEXhDpEBXuIjSEJk6V9w13OBFJjcZfw0WjBVA8q7wjQx4GKxQKVSYaXq9Tqm0ynzQ/bt8h1D8w07ZQd5JiOOY4RhCPNmQr9qsG82jAfHhmFwTqJRVFXlAHf2UJA5yR6epsypyOm6zpOMRiO0Wi3IsozlcsnifMrhZ0Y56lQIYdv2B765Q6FuUUnqhEYoOgFZlsUrJGLUOX2K8x8AhVIESMkojpls4XSZOqLRBJ98rnDm67V5eLF7yglFX5lEBO/3e5xOJ1wuF2iaBv8hTqaqwGyGg6risN/nb5zGe2VUVCKwWq2GcrmMUqmE4XDIF4gnx7ahn8/QdB3n85mfme3aQAK8WSPUrz9w/X3BbD7LheSRqbPNZsPrwMvrurzstE6/BgP+t1mv15jP57hqVyRxAj/1YUUW4jCGe3fztZKen9jz06PvJIQwHjn8YmRBuFD6v2/Z81jZ4v9nUbQ/A9gcuGBCOJ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/6434a7b39735d0872e7bbe65a30d703f/8c557/4.png\"\n        srcset=\"/static/6434a7b39735d0872e7bbe65a30d703f/5a46d/4.png 300w,\n/static/6434a7b39735d0872e7bbe65a30d703f/0a47e/4.png 600w,\n/static/6434a7b39735d0872e7bbe65a30d703f/8c557/4.png 700w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br/><br/></p>\n<p><a href=\"https://pencilflip.medium.com/using-es-modules-with-commonjs-modules-in-node-js-1015786dab03\">Using ES modules with CommonJS modules in Node.js</a><br/><br/></p>\n<p>아~ CommonJS는 걍 다 사용 가능하네~~</p>\n<p>그냥 cjs로만 빌드해서 사용할까? 근데 그럼 Tree-Shaking 안된다며…?</p>\n<p>하… 포기할까…? 하다가 끈기를 가지고 다시 도전!!!🔥</p>\n<p>그러다 package.json의 main과 module의 차이점에 대한 포스팅 발견!!<br/><br/></p>\n<p><a href=\"https://stackoverflow.com/questions/42708484/what-is-the-module-package-json-field-for\">What is the “module” package.json field for?</a></p>\n<p><a href=\"https://levelup.gitconnected.com/code-splitting-for-libraries-bundling-for-npm-with-rollup-1-0-2522c7437697#9f6f\">Code-splitting for libraries-bundling for npm with Rollup 1.0</a><br/><br/></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA70lEQVQY042QbWuDMBSF/f//bl1faNVGEzWaGOtgHRrbPMOsG2Mw6IHz4bzcy+Um1+sVYwzWWpxzkeN4wbn+xxuGgRDCU0zmeWaaJvyy4L2PXJYb3i/M3rPmq/cskgBI7WiNo+ocmTKca4vqRkTTI+oe0TgK7aIvaotuOzrryCsTO6Ue4tz7x0QSApwKzT5XHAvNLq85nitEqTjkis1JchA6cnMs2aaKXSbZ5xXbrOIgmpi9pvJ7YSCVhpfH4Lky5Kojk+3jop601PGaVZftQPrIMtnF7topasvtfv9a2JhLDFr3Fv+wer/xV0P494efc8rIHQRth2EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/9fd5f93a57b47f159fb7e530941724ff/c1b63/5.png\"\n        srcset=\"/static/9fd5f93a57b47f159fb7e530941724ff/5a46d/5.png 300w,\n/static/9fd5f93a57b47f159fb7e530941724ff/0a47e/5.png 600w,\n/static/9fd5f93a57b47f159fb7e530941724ff/c1b63/5.png 1200w,\n/static/9fd5f93a57b47f159fb7e530941724ff/2a333/5.png 1484w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br/></p>\n<p>아! <code class=\"language-text\">module</code>은 공식적인게 아니지만! 나중에 번들러가 참조하는거구나!!!</p>\n<p>이제 좀 이해가 가기 시작한다…</p>\n<p>어디서든 실행가능하도록 main은 cjs를 가리키게 하고 프로젝트 빌드할때 번들러가 <code class=\"language-text\">module</code>을 참조하는거구나~</p>\n<p>지금까지 알아낸 결과를 정리하자면…</p>\n<ol>\n<li>cjs로 만든 라이브러리는 프로젝트에서 import export 로 불러오고 내보내고 가능 (단, ejs로 작성된 라이브러리는 require로 못 불러낸다.)</li>\n<li>그러면 당연히 라이브러리를 만든다하면 대부분 지원되는 cjs로 배포하는게 이득인가??</li>\n<li>하지만 cjs는 트리쉐이킹이 안되자나!!!</li>\n<li>그럼 어쩌란거지???</li>\n<li>라이브러리 A를 만들 때 cjs버젼 ejs버젼 둘다 만든다. package.json에 module이라는 키 추가해서 값으로 ejs 경로 추가해줌. main은 cjs 경로 가리킴.</li>\n<li>프로젝트에 라이브러리 A를 인스톨하고 모듈들을 사용함. (import로 불러오든 require로 불러오든 상관 ㄴㄴ)</li>\n<li>프로젝트 완성후 완성한 프로젝트를 웹팩같은 번들러로 빌드를 할때 라이브러리 A의 package.json의 module을 참고해서 ejs형식을 참고하게되고 트리쉐이킹 가능해서 빌드할 때 현재 플젝에서 라이브러리 A에서 사용한 것만 긁어서 빌드한다!</li>\n</ol>\n<p>끝!!!</p>","frontmatter":{"title":"라이브러리 배포 cjs? ejs?","date":"August 20, 2021"}}},"pageContext":{"slug":"/development/library_deploy/","previous":{"fields":{"slug":"/javascript/catch_error/"},"frontmatter":{"title":"try-catch와 .catch"}},"next":{"fields":{"slug":"/development/aws_ecs_code_pipeline/"},"frontmatter":{"title":"AWS ECS와 CodePipeline"}}}},"staticQueryHashes":["1030119289","401124912"]}